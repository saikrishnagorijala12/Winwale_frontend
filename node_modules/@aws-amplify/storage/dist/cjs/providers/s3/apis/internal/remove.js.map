{"version":3,"file":"remove.js","sources":["../../../../../../src/providers/s3/apis/internal/remove.ts"],"sourcesContent":["\"use strict\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.remove = remove;\nconst utils_1 = require(\"@aws-amplify/core/internals/utils\");\nconst utils_2 = require(\"../../utils\");\nconst s3data_1 = require(\"../../utils/client/s3data\");\nconst userAgent_1 = require(\"../../utils/userAgent\");\nconst constants_1 = require(\"../../utils/constants\");\nconst createAbortableTask_1 = require(\"../../utils/createAbortableTask\");\nconst CanceledError_1 = require(\"../../../../errors/CanceledError\");\nfunction remove(amplify, input) {\n    return (0, createAbortableTask_1.createAbortableTask)(executeRemove(amplify, input));\n}\nconst executeRemove = (amplify, input) => async (abortController) => {\n    try {\n        const { s3Config, keyPrefix, bucket, identityId } = await (0, utils_2.resolveS3ConfigAndInput)(amplify, input);\n        const { inputType, objectKey } = (0, utils_2.validateStorageOperationInput)(input, identityId);\n        (0, utils_2.validateBucketOwnerID)(input.options?.expectedBucketOwner);\n        const finalKey = (0, utils_2.resolveFinalKey)(inputType, objectKey, keyPrefix);\n        (0, utils_2.validateRemovePath)(finalKey);\n        const isFolder = finalKey.endsWith('/') ||\n            (await (0, utils_2.isPathFolder)({\n                s3Config,\n                bucket,\n                key: finalKey,\n                expectedBucketOwner: input.options?.expectedBucketOwner,\n            }));\n        if (isFolder) {\n            return (0, utils_2.deleteFolderContents)({\n                s3Config,\n                bucket,\n                folderKey: finalKey,\n                expectedBucketOwner: input.options?.expectedBucketOwner,\n                onProgress: input.options?.onProgress,\n                abortSignal: abortController.signal,\n            });\n        }\n        else {\n            if (abortController.signal.aborted) {\n                throw new CanceledError_1.CanceledError({ message: 'Operation was cancelled' });\n            }\n            await (0, s3data_1.deleteObject)({\n                ...s3Config,\n                userAgentValue: (0, userAgent_1.getStorageUserAgentValue)(utils_1.StorageAction.Remove),\n                abortSignal: abortController.signal,\n            }, {\n                Bucket: bucket,\n                Key: finalKey,\n                ExpectedBucketOwner: input.options?.expectedBucketOwner,\n            });\n            const result = inputType === constants_1.STORAGE_INPUT_KEY\n                ? { key: objectKey }\n                : { path: objectKey };\n            return result;\n        }\n    }\n    catch (error) {\n        if (abortController.signal.aborted) {\n            throw new CanceledError_1.CanceledError({ message: 'Operation was cancelled' });\n        }\n        throw error;\n    }\n};\n"],"names":[],"mappings":";;AACA;AACA;AACA,MAAM,CAAC,cAAc,CAAC,OAAO,EAAE,YAAY,EAAE,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;AAC7D,OAAO,CAAC,MAAM,GAAG,MAAM;AACvB,MAAM,OAAO,GAAG,OAAO,CAAC,mCAAmC,CAAC;AAC5D,MAAM,OAAO,GAAG,OAAO,CAAC,aAAa,CAAC;AACtC,MAAM,QAAQ,GAAG,OAAO,CAAC,2BAA2B,CAAC;AACrD,MAAM,WAAW,GAAG,OAAO,CAAC,uBAAuB,CAAC;AACpD,MAAM,WAAW,GAAG,OAAO,CAAC,uBAAuB,CAAC;AACpD,MAAM,qBAAqB,GAAG,OAAO,CAAC,iCAAiC,CAAC;AACxE,MAAM,eAAe,GAAG,OAAO,CAAC,kCAAkC,CAAC;AACnE,SAAS,MAAM,CAAC,OAAO,EAAE,KAAK,EAAE;AAChC,IAAI,OAAO,IAAI,qBAAqB,CAAC,mBAAmB,EAAE,aAAa,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AACxF;AACA,MAAM,aAAa,GAAG,CAAC,OAAO,EAAE,KAAK,KAAK,OAAO,eAAe,KAAK;AACrE,IAAI,IAAI;AACR,QAAQ,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,UAAU,EAAE,GAAG,MAAM,CAAC,CAAC,EAAE,OAAO,CAAC,uBAAuB,EAAE,OAAO,EAAE,KAAK,CAAC;AACtH,QAAQ,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,6BAA6B,EAAE,KAAK,EAAE,UAAU,CAAC;AACtG,QAAQ,CAAC,CAAC,EAAE,OAAO,CAAC,qBAAqB,EAAE,KAAK,CAAC,OAAO,EAAE,mBAAmB,CAAC;AAC9E,QAAQ,MAAM,QAAQ,GAAG,CAAC,CAAC,EAAE,OAAO,CAAC,eAAe,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;AACtF,QAAQ,CAAC,CAAC,EAAE,OAAO,CAAC,kBAAkB,EAAE,QAAQ,CAAC;AACjD,QAAQ,MAAM,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC,GAAG,CAAC;AAC/C,aAAa,MAAM,CAAC,CAAC,EAAE,OAAO,CAAC,YAAY,EAAE;AAC7C,gBAAgB,QAAQ;AACxB,gBAAgB,MAAM;AACtB,gBAAgB,GAAG,EAAE,QAAQ;AAC7B,gBAAgB,mBAAmB,EAAE,KAAK,CAAC,OAAO,EAAE,mBAAmB;AACvE,aAAa,CAAC,CAAC;AACf,QAAQ,IAAI,QAAQ,EAAE;AACtB,YAAY,OAAO,CAAC,CAAC,EAAE,OAAO,CAAC,oBAAoB,EAAE;AACrD,gBAAgB,QAAQ;AACxB,gBAAgB,MAAM;AACtB,gBAAgB,SAAS,EAAE,QAAQ;AACnC,gBAAgB,mBAAmB,EAAE,KAAK,CAAC,OAAO,EAAE,mBAAmB;AACvE,gBAAgB,UAAU,EAAE,KAAK,CAAC,OAAO,EAAE,UAAU;AACrD,gBAAgB,WAAW,EAAE,eAAe,CAAC,MAAM;AACnD,aAAa,CAAC;AACd,QAAQ;AACR,aAAa;AACb,YAAY,IAAI,eAAe,CAAC,MAAM,CAAC,OAAO,EAAE;AAChD,gBAAgB,MAAM,IAAI,eAAe,CAAC,aAAa,CAAC,EAAE,OAAO,EAAE,yBAAyB,EAAE,CAAC;AAC/F,YAAY;AACZ,YAAY,MAAM,CAAC,CAAC,EAAE,QAAQ,CAAC,YAAY,EAAE;AAC7C,gBAAgB,GAAG,QAAQ;AAC3B,gBAAgB,cAAc,EAAE,CAAC,CAAC,EAAE,WAAW,CAAC,wBAAwB,EAAE,OAAO,CAAC,aAAa,CAAC,MAAM,CAAC;AACvG,gBAAgB,WAAW,EAAE,eAAe,CAAC,MAAM;AACnD,aAAa,EAAE;AACf,gBAAgB,MAAM,EAAE,MAAM;AAC9B,gBAAgB,GAAG,EAAE,QAAQ;AAC7B,gBAAgB,mBAAmB,EAAE,KAAK,CAAC,OAAO,EAAE,mBAAmB;AACvE,aAAa,CAAC;AACd,YAAY,MAAM,MAAM,GAAG,SAAS,KAAK,WAAW,CAAC;AACrD,kBAAkB,EAAE,GAAG,EAAE,SAAS;AAClC,kBAAkB,EAAE,IAAI,EAAE,SAAS,EAAE;AACrC,YAAY,OAAO,MAAM;AACzB,QAAQ;AACR,IAAI;AACJ,IAAI,OAAO,KAAK,EAAE;AAClB,QAAQ,IAAI,eAAe,CAAC,MAAM,CAAC,OAAO,EAAE;AAC5C,YAAY,MAAM,IAAI,eAAe,CAAC,aAAa,CAAC,EAAE,OAAO,EAAE,yBAAyB,EAAE,CAAC;AAC3F,QAAQ;AACR,QAAQ,MAAM,KAAK;AACnB,IAAI;AACJ,CAAC;;"}